<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Test</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
      }
    </style>
  </head>
  <body style="height: 100vh">
    <input
      id="el-picker"
      type="file"
      accept=".doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
    />

    <button type="button" onclick="trackChangesWindow()">
      Track Changes Window
    </button>
    <button type="button" onclick="toggleTrackChanges()">
      TOGGLE TRACK CHANGES
    </button>
    <button type="button" onclick="acceptTrackChange()">Accept TC</button>
    <button type="button" onclick="rejectTrackChange()">Reject TC</button>
    <script src="wrapper.js"></script>
    <office-doc id="el-embed" />
    <script>
      const picker = document.getElementById("el-picker");
      const embed = document.getElementById("el-embed");

      libreoffice.on("status_indicator_set_value", (x) => {
        console.log(x);
      });

      libreoffice.on("status_changed", (x) => {
        console.log("lo", x);
      });

      libreoffice.on("window", (x) => {
        console.log("lo", x);
      });

      let globalDoc;
      picker.onchange = () => {
        if (picker.files.length === 1) {
          const uri = encodeURI(
            "file:///" + picker.files[0].path.replace(/\\/g, "/")
          );
          const doc = libreoffice.loadDocument(uri);
          doc.on("ready", (x) => {
            globalDoc = doc;
            console.log("Document Ready", x);

            const encodedData = new TextEncoder().encode(
              "testing 123, will is cool"
            );

            const clipboardData = [
              {
                mimeType: "text/plain",
                buffer: encodedData.buffer,
              },
            ];

            console.log("OUTLINE", doc.getCommandValues(".uno:GetOutline"));
          });

          embed.renderDocument(doc);
          embed.focus();
        }
      };
      function trackChangesWindow() {
        globalDoc.postUnoCommand(".uno:AcceptTrackedChanges");
      }

      function toggleTrackChanges() {
        globalDoc.postUnoCommand(".uno:TrackChanges");
      }
      function acceptTrackChange() {
        globalDoc.postUnoCommand(".uno:AcceptTrackedChange");
      }
      function rejectTrackChange() {
        globalDoc.postUnoCommand(".uno:RejectTrackedChange");
      }
    </script>
  </body>
</html>
